<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VueSetProps: 一个全局初始化组件库组件 props 的插件 | Markyong</title>
    <meta name="generator" content="VuePress 1.5.0">
    <script src="/js/waterrippleeffect.min.js"></script>
    <meta name="description" content="markyong">
    <link rel="preload" href="/assets/css/0.styles.5d52fb7f.css" as="style"><link rel="preload" href="/assets/js/app.27152e69.js" as="script"><link rel="preload" href="/assets/js/3.217ffc09.js" as="script"><link rel="preload" href="/assets/js/8.83509520.js" as="script"><link rel="prefetch" href="/assets/js/2.5ca317ef.js"><link rel="prefetch" href="/assets/js/4.6c3148f3.js"><link rel="prefetch" href="/assets/js/5.f94fd413.js"><link rel="prefetch" href="/assets/js/6.e5def81f.js"><link rel="prefetch" href="/assets/js/7.c4875c8a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d52fb7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div style="min-height:100vh;"><header id="header"><div class="header-main"><h1 class="title"><a href="/" class="router-link-active">Markyong</a></h1> <div class="wrap"><div id="header-image" class="header-image"></div> <div class="text">
        喜新恋旧，败事不足。
        <div class="social"><a href="https://github.com/markyong" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svg-inline--fa fa-github fa-w-16"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-twitter fa-w-16"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weibo" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-weibo fa-w-16"><path fill="currentColor" d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"></path></svg></a></div></div></div></div></header> <div class="content-wrap"><div class="post-wrap"><h1 class="title">VueSetProps: 一个全局初始化组件库组件 props 的插件</h1> <div class="create"><span>创建于 2020-11-7</span></div> <div class="post-content content__default"><p>我们平常在使用 <code>Vue</code> 开发项目的时候，肯定是会使用一些组件库或者全局组件，但是有些全局组件或者组件库中的组件的初始 <code>props</code> 属性没有默认值或者设定默认值不是我们想要的，这就使得我们需要在具体使用组件的地方为其设置一些我们期望的值。这里以 <code>Element</code> 组件库为例，比如我们在项目中使用 <code>Table</code> 组件，整个项目的表格设计都是带边框的，但是 <code>Table</code> 组件默认是不带 border 的，所以我们需要在每个使用 <code>Table</code> 组件的地方手动将 border 设为 <code>true</code>。这么做或许有些许麻烦，因此我实现了一个插件： <code>VueSetProps</code>，使用它对于统一的属性值或者大多数需要设置的属性值你不需要在每一处使用时单独设置了，你只需要在初始化的时候统一设置，后面使用的所有组件都会生效。当然，如果你在某处不希望使用设置的全局默认属性，只需要在具体使用的时候设置值覆盖默认值即可。</p> <p>下面是 <code>VueSetProps</code> 具体使用方式：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i vue-set-props -S
<span class="token comment"># or</span>
<span class="token function">yarn</span> <span class="token function">add</span> vue-set-props
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> ElementUI <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> VueSetProps <span class="token keyword">from</span> <span class="token string">'vue-set-props'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementUI<span class="token punctuation">)</span>
<span class="token comment">// 必须在组件库或全局组件注册后使用</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueSetProps<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  ElInput<span class="token operator">:</span> <span class="token punctuation">{</span>
    clearable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ElButton<span class="token operator">:</span> <span class="token punctuation">{</span>
    round<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 其他全局组件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
</code></pre></div><p>经过上面的初始化设置，在使用 <code>Input</code> 组件时都会带上可清除的图标，<code>Table</code> 组件时都会带上表格边框，不需要在具体使用时单独设置。具体使用细节可以参考<a href="https://github.com/markyong/vue-set-props" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>其实 <code>VueSetProps</code> 的原理很简单，就是根据对应组件找到对应的 <code>props</code> 设置通过修改或添加 <code>default</code> 属性设置默认值。可以这么做得益于 <code>Vue</code> 内部对应 <code>props</code> 属性的规范化。这里还是以 <code>Element</code> 为例，在 <code>Vue.use(ElementUI)</code> 调用时，内部其实是调用 <code>Vue.component()</code> 将一个个组件挂载到全局，而调用此方法时，<code>Vue</code> 内部会使用 <code>mergeOptions</code> 进行选项的合并规范。我们都知道 <code>Vue</code> 为我们提供了多种 <code>props</code> 的写法，下面列出对应的写法即内部处理后的结果：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 一个数组</span>
props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token string">'myMessage'</span><span class="token punctuation">]</span>
<span class="token comment">// 合并处理后</span>
props<span class="token operator">:</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  myMessage<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 带有类型</span>
props<span class="token operator">:</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> Number
<span class="token punctuation">}</span>
<span class="token comment">// 合并处理后</span>
props<span class="token operator">:</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Number <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. 带有默认值</span>
props<span class="token operator">:</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 合并处理后</span>
props<span class="token operator">:</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过上面的分析，我们可以看出 <code>props</code> 的属性的对应值最后都被处理为一个对象，借助于此我们可以修改其对应的 default 或者手动添加 default 属性值，而不用去考虑兼容多种 <code>props</code> 的写法，这也是 <code>VueSetProps</code> 必须在组件库注册后使用的原因。</p> <p>知道了上面这些，最后就是找到组件对应的 prop 属性。我们都知道，<code>Vue</code> 可以在组件自身中定义 <code>props</code> 选项，也提供了通过 <code>mixins</code> 方式来混入 <code>props</code> 选项，其内部会对两者做一个合并处理。所以 <code>VueSetProps</code> 内部在找对应的 prop 时会在组件本身 <code>props</code> 选项以及 <code>mixins</code> 选项中依次递归寻找，找到就修改或者设置其对应的 default 值，而对于设置的 defalut 类型是否符合类型，则交给 <code>Vue</code> 后续运行时去校验。</p> <p>通过以上方式就实现了对应组件库组件的初始化默认值的设置，一处设置，全局使用。</p> <p>Chat: 现在对于设置的 prop，如果没有在对应组件选项中找到，则会被忽略掉且在非生产环境打印一个警告，对于此，想到的另一个点是把没有找到的 prop 挂载到对于到组件到 <code>$attrs</code> 上，这样就能覆盖到更全的场景，但是 <code>$attrs</code> 是在具体组件运行时处理的。所以对于此，如果你有好的 idea 或者好的实现方式，👏欢迎来提交 <a href="https://github.com/markyong/vue-set-props/issues" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <div class="bottom-line"></div></div></div> <footer id="footer"><div class="copyright">© Mark 2023</div> <div>
    Powered by <a href="https://vuepress.vuejs.org/" target="_blank">Vuepress</a>.
    Theme by <a href="https://github.com/markyong/vuepress-theme-stage" target="_blank">Stage</a></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.27152e69.js" defer></script><script src="/assets/js/3.217ffc09.js" defer></script><script src="/assets/js/8.83509520.js" defer></script>
  </body>
</html>
